# <% $deploy_variables = {} unless defined?($deploy_variables) %>
default: &default
  build:
    cache:
      - /app/env
    commands:
      - virtualenv env
      - source env/bin/activate
      - pip install -r requirements.txt --no-cache-dir

  deploy:
    nexus: { username: 'brigade-deployment', password: '8HBF5mMcfgkBSUp', group: 'verifier-deploy', tar_uid: 4060, tar_gid: 4060 }
***REMOVED***

  run:
    web: env/bin/gunicorn web:app -b 0.0.0.0:3000 --log-file=-
    test: source env/bin/activate && make test

  dependencies:
    - elasticsearch

  env: &default_env
    APP_DIRECTORY: '/mnt/mesos/sandbox'
    UID: 4060 # pinned in cuisine/data_bags/users/verifier.json
    GID: 4060 # pinned in cuisine/data_bags/users/verifier.json

###############################################################################
# EDGE
###############################################################################
edge:
  <<: *default

  env:
    <<: *default_env

###############################################################################
# STAGING
###############################################################################
staging:
  <<: *default

  env:
    <<: *default_env

###############################################################################
# PRODUCTION
###############################################################################
production:
  <<: *default

  env:
    <<: *default_env
